<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.4.1"><title>Architecture & Design - SaaS Big Data Demo</title><link rel=stylesheet href=../assets/stylesheets/main.69437709.min.css><link rel=stylesheet href=../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#architecture-and-design class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="SaaS Big Data Demo" class="md-header__button md-logo" aria-label="SaaS Big Data Demo" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> SaaS Big Data Demo </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Architecture & Design </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/big-data-tenant-analytics.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="SaaS Big Data Demo" class="md-nav__button md-logo" aria-label="SaaS Big Data Demo" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> SaaS Big Data Demo </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/big-data-tenant-analytics.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../dashboard/ class=md-nav__link> Business Dashboard </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Architecture & Design <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Architecture & Design </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#component-view class=md-nav__link> Component view </a> </li> <li class=md-nav__item> <a href=#domain-driven-design class=md-nav__link> Domain Driven Design </a> <nav class=md-nav aria-label="Domain Driven Design"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#event-definition class=md-nav__link> Event Definition </a> </li> <li class=md-nav__item> <a href=#business-entities class=md-nav__link> Business entities </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#eks-cluster-creation-and-solution-deployment class=md-nav__link> EKS cluster creation and solution deployment </a> </li> <li class=md-nav__item> <a href=#kinesis-data-streams class=md-nav__link> Kinesis Data Streams </a> <nav class=md-nav aria-label="Kinesis Data Streams"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#why class=md-nav__link> Why </a> </li> <li class=md-nav__item> <a href=#deployment class=md-nav__link> Deployment </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#kinesis-data-analytics class=md-nav__link> Kinesis Data Analytics </a> <nav class=md-nav aria-label="Kinesis Data Analytics"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#when-to-choose-what class=md-nav__link> When to choose what </a> </li> <li class=md-nav__item> <a href=#implementation-details class=md-nav__link> Implementation Details </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#quicksight-integration-design class=md-nav__link> QuickSight Integration Design </a> </li> <li class=md-nav__item> <a href=#api-gateway-and-lambda-function-for-sagemaker class=md-nav__link> API Gateway And Lambda Function for SageMaker </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../eks/ class=md-nav__link> EKS </a> </li> <li class=md-nav__item> <a href=../model/ class=md-nav__link> ML model </a> </li> <li class=md-nav__item> <a href=../api-lambda/ class=md-nav__link> API Gateway - Lambda </a> </li> <li class=md-nav__item> <a href=../rt-analytics/ class=md-nav__link> RT Analytics </a> </li> <li class=md-nav__item> <a href=../java-apps/ class=md-nav__link> Tenant Manager </a> </li> <li class=md-nav__item> <a href=../cdk/ class=md-nav__link> Infrastructure as code </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/aws-studies/ class=md-nav__link> AWS studies </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#component-view class=md-nav__link> Component view </a> </li> <li class=md-nav__item> <a href=#domain-driven-design class=md-nav__link> Domain Driven Design </a> <nav class=md-nav aria-label="Domain Driven Design"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#event-definition class=md-nav__link> Event Definition </a> </li> <li class=md-nav__item> <a href=#business-entities class=md-nav__link> Business entities </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#eks-cluster-creation-and-solution-deployment class=md-nav__link> EKS cluster creation and solution deployment </a> </li> <li class=md-nav__item> <a href=#kinesis-data-streams class=md-nav__link> Kinesis Data Streams </a> <nav class=md-nav aria-label="Kinesis Data Streams"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#why class=md-nav__link> Why </a> </li> <li class=md-nav__item> <a href=#deployment class=md-nav__link> Deployment </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#kinesis-data-analytics class=md-nav__link> Kinesis Data Analytics </a> <nav class=md-nav aria-label="Kinesis Data Analytics"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#when-to-choose-what class=md-nav__link> When to choose what </a> </li> <li class=md-nav__item> <a href=#implementation-details class=md-nav__link> Implementation Details </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#quicksight-integration-design class=md-nav__link> QuickSight Integration Design </a> </li> <li class=md-nav__item> <a href=#api-gateway-and-lambda-function-for-sagemaker class=md-nav__link> API Gateway And Lambda Function for SageMaker </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/jbcodeforce/big-data-tenant-analytics.git/edit/master/docs/design.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=architecture-and-design>Architecture and Design<a class=headerlink href=#architecture-and-design title="Permanent link">&para;</a></h1> <p>This section addresses major architecture decisions and design choices:</p> <ul> <li>Real-time streaming and analytics</li> <li>API gateway and ML predictive scoring.</li> <li>Business intelligence on data at rest.</li> </ul> <h2 id=component-view>Component view<a class=headerlink href=#component-view title="Permanent link">&para;</a></h2> <p>As presented in the introduction we have the following components in scope for this demonstration:</p> <p><img alt src=../diagrams/solution-comp-view.drawio.png></p> <p><strong>Figure 1: Solution Component View</strong></p> <ul> <li><a href=./#quicksight-integration-design>The Dashboard</a> to present business insight on the execusion of the SaaS business. It uses AWS QuickSight.</li> <li><a href=../model>SageMaker to support development of scoring model and runtime deployment</a>.</li> <li><a href=#api-gateway-and-lambda-function-for-sagemaker>API Gateway and Lambda</a> to proxy the predictive service and do data transformation.</li> <li><a href=#kinesis-data-analytics>Real-time data analytics</a> to do stateful processing.</li> </ul> <h2 id=domain-driven-design>Domain Driven Design<a class=headerlink href=#domain-driven-design title="Permanent link">&para;</a></h2> <h3 id=event-definition>Event Definition<a class=headerlink href=#event-definition title="Permanent link">&para;</a></h3> <p>We need to track the following events:</p> <ul> <li>tenant created: company name and industry, sentiment about the company</li> <li>user added, user deleted</li> <li>user login, user logoff, user session timeoff</li> <li>jobSubmitted, jobTerminated, jobCancelled</li> <li>Concentrates those events into kinesis streams: companies, jobs</li> <li>Keep data for 24 hours</li> <li>Move data for long term persistence to S3, one bucket per companies</li> </ul> <h3 id=business-entities>Business entities<a class=headerlink href=#business-entities title="Permanent link">&para;</a></h3> <ul> <li>We define Tenant as part of the tenant manager microservice, which will be considered as company in the risk scoring domain</li> <li>Job is the entity to present big data batch processing.</li> </ul> <h2 id=eks-cluster-creation-and-solution-deployment>EKS cluster creation and solution deployment<a class=headerlink href=#eks-cluster-creation-and-solution-deployment title="Permanent link">&para;</a></h2> <p>The microservices are deployed to EKS. We could have added Kafka as a middleware, deployed in EKS with the Strimzi operator, but the goal of this demonstration is to integrate with Kinesis Data Streams and Kinesis Data Analytics.</p> <h2 id=kinesis-data-streams><a href=https://aws.amazon.com/kinesis/data-analytics/ >Kinesis Data Streams</a><a class=headerlink href=#kinesis-data-streams title="Permanent link">&para;</a></h2> <h3 id=why>Why<a class=headerlink href=#why title="Permanent link">&para;</a></h3> <p>This is a managed service for pub/sub streaming data. It is a distributed data stream into Shards for parallel processing. Producer sends message with <code>Partition Key</code> and a throughput of 1 Mb/s or 1000 msg /s per Shard. A sequence number is added to the message to note where the message is in the Shard. </p> <ul> <li>Retention from 1 to 365 days.</li> <li>Capable to replay the messages.</li> <li>Immutable records, not deleted by applications.</li> <li>Message in a shard, can share partition key, and keep ordering.</li> <li>Producer can use SDK, or Kinesis Producer Library (KPL) or being a Kinesis agent.</li> <li>Consumer may use SDK and Kinesis Client Library (KCL), or being one of the managed services like: Lambda, Kinesis Data Firehose, Kinesis Data Analytics.</li> <li>For consuming side, each Shard gets 2MB/s out.</li> <li>It uses enhanced fan-out if we have multiple consumers retrieving data from a stream in parallel. This throughput automatically scales with the number of shards in a stream.</li> <li>Pricing is per Shard provisioned per hour.</li> <li>The capacity limits of a Kinesis data stream are defined by the number of shards within the data stream. The limits can be exceeded by either data throughput or the number of reading data calls. Each shard allows for 1 MB/s incoming data and 2 MB/s outgoing data. You should increase the number of shards within your data stream to provide enough capacity.</li> </ul> <h3 id=deployment>Deployment<a class=headerlink href=#deployment title="Permanent link">&para;</a></h3> <p>The CDK app under <code>setup/kinesis-cdk</code> folder defines the following components:</p> <p>And the steps to start them are:</p> <ul> <li>Start the CDK app to create CloudFormation template and run it</li> </ul> <div class=highlight><pre><span></span><code><span class=nb>cd</span> setup/kinesis-cdk
cdk deploy
</code></pre></div> <ul> <li>Verify the stream is created</li> </ul> <div class=highlight><pre><span></span><code>aws kinesis list-streams
aws kinesis describe-stream-summary --stream-name bg-jobs
<span class=o>{</span>
    <span class=s2>&quot;StreamDescriptionSummary&quot;</span>: <span class=o>{</span>
        <span class=s2>&quot;StreamName&quot;</span>: <span class=s2>&quot;bg-jobs&quot;</span>,
        <span class=s2>&quot;StreamARN&quot;</span>: <span class=s2>&quot;arn:aws:kinesis:us-west-2:403993201276:stream/bg-jobs&quot;</span>,
        <span class=s2>&quot;StreamStatus&quot;</span>: <span class=s2>&quot;ACTIVE&quot;</span>,
        <span class=s2>&quot;StreamModeDetails&quot;</span>: <span class=o>{</span>
            <span class=s2>&quot;StreamMode&quot;</span>: <span class=s2>&quot;PROVISIONED&quot;</span>
        <span class=o>}</span>,
        <span class=s2>&quot;RetentionPeriodHours&quot;</span>: <span class=m>24</span>,
        <span class=s2>&quot;StreamCreationTimestamp&quot;</span>: <span class=s2>&quot;2022-12-20T21:11:04-08:00&quot;</span>,
        <span class=s2>&quot;EnhancedMonitoring&quot;</span>: <span class=o>[</span>
            <span class=o>{</span>
                <span class=s2>&quot;ShardLevelMetrics&quot;</span>: <span class=o>[]</span>
            <span class=o>}</span>
        <span class=o>]</span>,
        <span class=s2>&quot;EncryptionType&quot;</span>: <span class=s2>&quot;KMS&quot;</span>,
        <span class=s2>&quot;KeyId&quot;</span>: <span class=s2>&quot;alias/aws/kinesis&quot;</span>,
        <span class=s2>&quot;OpenShardCount&quot;</span>: <span class=m>1</span>,
        <span class=s2>&quot;ConsumerCount&quot;</span>: <span class=m>0</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></div> <ul> <li> <p>Put records</p> </li> <li> <p>Validate Records, even if data is encrypted by default:</p> </li> </ul> <div class=highlight><pre><span></span><code><span class=nv>SHARD_ITERATOR</span><span class=o>=</span><span class=k>$(</span>aws kinesis get-shard-iterator --shard-id shardId-000000000000 --shard-iterator-type TRIM_HORIZON --stream-name bg-jobs --query <span class=s1>&#39;ShardIterator&#39;</span><span class=k>)</span>

aws kinesis get-records --shard-iterator <span class=nv>$SHARD_ITERATOR</span>
</code></pre></div> <h2 id=kinesis-data-analytics><a href=https://aws.amazon.com/kinesis/data-analytics/ >Kinesis Data Analytics</a><a class=headerlink href=#kinesis-data-analytics title="Permanent link">&para;</a></h2> <p>This is a managed service to transform and analyze streaming data in real time using Apache Flink, an open-source framework and engine for processing data streams. It can consume records from different source, and in this demonstration we use Kinesis Data Streams.</p> <p><img alt src=https://d1.awsstatic.com/architecture-diagrams/Product-Page-Diagram_Amazon-Kinesis-Data-Analytics_HIW.82e3aa53a5c87db03c766218b3d51f1a110c60eb.png></p> <p>The underlying architecture consists of a <strong>Job Manager</strong> and n <strong>Task Managers</strong>. </p> <ul> <li>The <strong>JobManager</strong> controls the execution of a single application. It receives an application for execution and builds a Task Execution Graph from the defined Job Graph. It manages job submission and the job lifecycle then allocates work to Task Managers.</li> <li>The <strong>Resource Manager</strong> manages Task Slots and leverages underlying orchestrator, like Kubernetes or Yarn.</li> <li> <p>A <strong>Task slot</strong> is the unit of work executed on CPU.</p> </li> <li> <p>The <strong>Task Managers</strong> execute the actual stream processing logic. There are multiple task managers running in a cluster. The number of slots limits the number of tasks a TaskManager can execute. After it has been started, a TaskManager registers its slots to the ResourceManager</p> </li> </ul> <p><img alt src=../images/flink-arch.png width=600px></p> <p>To support the execution of Flink job, KDA provides resources using units called Kinesis Processing Units (KPUs).</p> <ul> <li> <p>One KPU represents the following system resources:</p> <ul> <li>One CPU core</li> <li>4 GB of memory, of which one GB is native memory and three GB are heap memory</li> <li>50 GB of disk space</li> </ul> </li> </ul> <p>The number of KPU = Parallelism parameter / ParallelismPerKPU parameter.</p> <h3 id=when-to-choose-what>When to choose what<a class=headerlink href=#when-to-choose-what title="Permanent link">&para;</a></h3> <p>As Apache Flink is an open-source project, it is possible to deploy it in a Kubernetes cluster, using Flink operator. This will bring you with the most flexible solution as you can select the underlying EC2 instances needed, to optimize your cost. Also you will have fine-grained control over cluster settings, debugging tools and monitoring.</p> <p>While Kinesis Data Analytics helps you to focus on the application logic, which is not simple programming experience, as stateful processing is challenginf, there is no management of infrastructure, monitoring, auto scaling and high availability integrated in the service.</p> <p>In addition to the AWS integrations, the Kinesis Data Analytics libraries include more than 10 Apache Flink connectors and the ability to build custom integrations. </p> <h3 id=implementation-details>Implementation Details<a class=headerlink href=#implementation-details title="Permanent link">&para;</a></h3> <p><a href=../rt-analytics/ >See this dedicated note</a></p> <h2 id=quicksight-integration-design>QuickSight Integration Design<a class=headerlink href=#quicksight-integration-design title="Permanent link">&para;</a></h2> <p>We need to represent the following metrics within QuickSight:</p> <ul> <li>tenants, # of users</li> <li>job submitted over time per tenant</li> <li>last activity date per tenant</li> <li>number of job in last 30 and 90 days</li> </ul> <p>The Dashboard is supported by Amazon QuickSight, which helps us to develop Analysis from different datasources, with drill down capabilities. The datasources are in S3 bucket with files that are continuously updated by the Data Streaming and Analtics components. </p> <p><img alt src=../diagrams/qs-arch.drawio.png></p> <p>In QuiskSight data sources are mapped to data sets, and we can apply data transformation for a better usage in analysis and visualisation. </p> <p>Here is an example of User Interface constructs:</p> <p><img alt src=../images/qs-dashboard.png></p> <p>For some implementation details <a href=../dashboard/ >see this note</a>.</p> <p>In the future we can automate the deployment of this dashboard by using CloudFormation. See <a href=https://devops.learnquicksight.online/quicksight-via-cloudformation.html>this note</a>.</p> <h2 id=api-gateway-and-lambda-function-for-sagemaker>API Gateway And Lambda Function for SageMaker<a class=headerlink href=#api-gateway-and-lambda-function-for-sagemaker title="Permanent link">&para;</a></h2> <p>As introduced in figure 1, API Gateway is deployed to expose REST API, and specially one supported by a Lambda function in backend to proxy SageMaker. The goal here is to add an anti-corruption layer into the domain of data streaming which most of the time represent business events while SageMaker use csv type of input.</p> <p>There is a cloudFormation template defined in <a href=https://github.com/jbcodeforce/big-data-tenant-analytics/tree/main/setup/cloudformation>setup/cloudformation folder</a> named <code>APIGW-Lambda.yaml</code> to declare API Gateway, role, and Lambda function. The following command create this stack in the connected Region:</p> <div class=highlight><pre><span></span><code>aws cloudformation create-stack --stack-name apigw-lambda-sm --template-body file://APIGW-Lambda.yaml --parameters <span class=nv>ParameterKey</span><span class=o>=</span>sagemakerEndpoint,ParameterValue<span class=o>=</span>linear-learner-2022-12-22-23-12-40-646 --capabilities CAPABILITY_NAMED_IAM
<span class=c1># Result looks like:</span>
<span class=o>{</span>
    <span class=s2>&quot;StackId&quot;</span>: <span class=s2>&quot;arn:aws:cloudformation:us-west-2:......:stack/apigw-lambda-sm/5041dce0-.....8258-11ed-8ddc-06ec61b22a8d&quot;</span>
<span class=o>}</span>
</code></pre></div> <p><img alt src=../images/cf-apigw-lambda.png></p> <p>We can access the Lambda and perform a smoke test to verify we reach the SageMaker endpoint.</p> <p><img alt src=../images/test-lambda.png></p> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../dashboard/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Business Dashboard" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Business Dashboard </div> </div> </a> <a href=../eks/ class="md-footer__link md-footer__link--next" aria-label="Next: EKS" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> EKS </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.tracking", "navigation.tabs.sticky"], "search": "../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../assets/javascripts/bundle.9c69f0bc.min.js></script> </body> </html>